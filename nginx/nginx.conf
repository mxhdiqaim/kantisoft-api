server {
    # Listen on port 80 for HTTP and redirect all traffic to HTTPS (443)
    listen 80;
    listen [::]:80;
    server_name kantisoft.com www.kantisoft.com;
    return 301 https://$host$request_uri;
}

server {
    # Listen on port 443 for HTTPS (SSL/TLS Termination happens here)
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name kantisoft.com www.kantisoft.com;

    # *** SSL Configuration (Certbot will put files here) ***
    ssl_certificate /etc/letsencrypt/live/kantisoft.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/kantisoft.com/privkey.pem;

    # For strong SSL settings (optional)
    # include /etc/nginx/snippets/ssl-params.conf;

    location / {
        # Forward the request to the 'api' service (which is listening on 5473 internally)
        proxy_pass http://api:5473;

        # Forward required headers to the backend
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_buffering off;
    }
}